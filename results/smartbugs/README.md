# APR on Smartbugs-curated overview

Each contract is labeled with only one category. For more details, refer to the file _contracts.csv_

## Directory Structure

The directory structure of the project is as follows:

- `Tool Name`: Directory contains the results for the execution of the tool given by the directory's name.
    + `Smartbugs-curated type`:
        - `contract_file_name`: directory with results for the respective contract.
            - `contract_file_name.sol`*: Solidity patch generated by the respective tool.
            - `contract_file_name.bin`: Bytecode code of the patch generated by the respective tool.
            - `other`: other metadata and outputs from the tool.
        - `return_codes.csv`:  return codes of each contract execution for th respective tool.
        - `patches_diff.csv`: comparisons between the patches and their original contract files.
        - `compilation_results_VERSION.csv`: pacthes with their respective compilability with the solidity VERSION. Only available for solidity patches.
        - `valid_patches.csv`: pacthes that are compilable and different from their original contract.
        - `patches_with_bugs.csv`: patches with bugs, vulnerability reports and the original contract vulnerability reports.
        - `patches_without_bugs.csv`: patches without bugs, vulnerability reports and the original contract vulnerability reports.

- `contracts.csv`: This file contains more details about each contract, including their labels.

*If the tool generates multiple patches for each contract file, then the patches naming convention is given by the tool itself. Each patch is prefixed by the `contract_file_name` and suffixed by their respective extension (`.sol` if source code, `.bin` if bytecode).


## Execution of the APR tools
|Tool\Return code                    |0 (success)|1 (errors)|timeout (4hr)|134(heap out of memory)|139 (segfault: core dump)|251 (compilation)|253|Notes                                                             |
|------------------------------------|-----------|----------|---------------|-----------------------|-------------------------|-----------------|---|------------------------------------------------------------------|
|[Elysium](https://github.com/ASSERT-KTH/RepairComp/blob/main/results/smartbugs/Elysium/return_codes.csv)  (binary)                           |121        |20        |1              |0                      |0                        |1                |0  |1: run_oyente breaks, only mythril is used for these cases in eval|
|[Smartshield](https://github.com/ASSERT-KTH/RepairComp/blob/main/results/smartbugs/SmartShield/return_codes.csv)   (binary)                       |135        |6         |2              |0                      |0                        |0                |0  |1: code errors                                                    |
|[sGuard](https://github.com/ASSERT-KTH/RepairComp/blob/main/results/smartbugs/sGuard/return_codes.csv)                              |132        |1         |2              |8                      |0                        |0                |0  |                                                                  |
|[sGuardPlus](https://github.com/ASSERT-KTH/RepairComp/blob/main/results/smartbugs/sGuardPlus/return_codes.csv)                          |111        |33        |0              |0                      |0                        |0                |0  |Exceptions in revert2src.js                                       |
|[SmartFix](https://github.com/ASSERT-KTH/RepairComp/blob/main/results/smartbugs/SmartFix/return_codes.csv)                            |135        |8         |0              |0                      |0                        |0                |0  |                                                                  |
|Aroc                                |135        |0         |0              |0                      |8                        |0                |0  |                                                                  |
|[TIPS](https://github.com/ASSERT-KTH/RepairComp/blob/main/results/smartbugs/TIPS/return_codes.csv)                                |140        |3         |0              |0                      |0                        |0                |0  |1: code errors in parsing json objects                            |
|[SolGPT](https://github.com/ASSERT-KTH/RepairComp/blob/main/results/smartbugs/SolGPT/patches_per_contract.csv)                              |139        |4         |0              |0                      |0                        |0                |0  |1: openai or slither                            |

## Vulnerabilities detected by the APR tools
| Tool                  | contract files w/ vuln | total vulnerabilities | 
|-----------------------|------------------------|-----------------------|
| **Smartbugs-curated** |                    143 |                   207 |
| Elysium (binary)      |                     96 |                   208 |
| Smartshield (binary)  |                     74 |                   126 |
| sGuard                |                     62 |                   428 |
| sGuardPlus            |                    112 |                   195 |
| SmartFix              |                     89 |                   476 |
| TIPS                  |                     90 |                   100 |
| [SolGPT](https://github.com/ASSERT-KTH/RepairComp/blob/main/results/smartbugs/SolGPT/vulns_Medium.csv)                |                    112 |                   318 |


## Patches overview in smartbugs-curated (patches)

```
find sGuard -name "*.sol" | wc
find sGuardPlus/ -name "*.sol" | wc
find Smart -name "*.sol" | wc
find SmartFix/ -name "*.sol" | wc
find TIPS/ -name "*.sol" | wc
ls SmartFix/*/*/*sol | wc
find SolGPT/ -name "*round.sol" | wc

find Elysium/ -name "*.bin" | wc
find SmartShield/ -name "*.bin" | wc
```

| Tool                  | #outputs | #diff patches | compilable | patches w/o bugs | patches w/ bugs | paches w/ new bugs (detector+manual check) | og contracts w/o bugs |
|-----------------------|----------|---------------|------------|------------------|-----------------|--------------------|-----------------------|
| Elysium (binary)      |      121 |            95 |           -|                  |                 |                    |                     26|
| Smartshield (binary)  |      135 |            135|           -|                  |                 |                    |                     68|
| sGuard                |      109 |             62|         108|                 2|               56|                    |                      2|
| sGuardPlus            |       81 |             81|          81|                71|               10|                  10|                     71|
| SmartFix              |       86 |             86|          86|                66|               20|                   1|                     66|
| TIPS                  |      242 |            242|         234|               177|               57|                    |                    132|
| SolGPT                |      552 |            552|         527|               251|              276|                    |                     70|




# Per Contract Overview (Updated on 17th December)
This table collects the information per contract in the dataset. For tools that generate multiple patches(SolGPT &TIPS) we count if at least 1 patch fulfills the category.
- Total contracts in the repository: 143
- 1 duplicate (0x627fa62ccbb1c1b04ffaecd72a53e37fc0e17839.sol)
- Valid Patches are the amount of contracts per tool that have a different patch and compile
- Detected means. amount of original files per tool labeled with a (or more) vulnerability from the corresponding dataset label.
- Fixed means that the number of original contracts per tool that have patches where the corresponding vulnerabilities number was reduced


| Tool                  | #generation | compilable | #diff patches | valid patches (Comp&Diff) | Detected | Fixed |
|-----------------------|-------------|------------|---------------|---------------------------|----------|-------|
| Elysium (binary)      |         121 |         N/A|             95|                         95|       52 |    52 |
| Smartshield (binary)  |         135 |         N/A|            135|                        135|       59 |    59 |
| sGuard                |         109 |         108|             62|                         61|       35 |     3 |
| sGuardPlus            |          81 |          81|             81|                         81|       70 |    70 |
| SmartFix              |          86 |          86|             86|                         86|       51 |    50 |
| SolGPT                |         139 |         138|            139|                        138|       97 |    89 |
| TIPS                  |         140 |         138|            140|                        138|       82 |    81 |


# Mitigated exploits
Number of mitigated exploits directly corresponds to "vulnerability-free" contract.

| Tool                    | #Failed sanity checks | #Total exploits mitigated | #Unique exploits mitigated |
|-------------------------|-----------------------|----------------------------|---------------------------|
| sGuard | 1 | 30 | 0 |
| sGuardPlus | 0 | 44 | 0 |
| SmartFix | 4 | 48 | 1 |
| SolGPT | 7 | 67 | 4 |
| TIPS | 1 | 45 | 4 |
| Elysium (binary) | 26 | 29 | 1 |
| SmartShield (binary) | 21 | 26 | 0 |
Exploits not mitigated by any tool:  11